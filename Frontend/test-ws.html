<!DOCTYPE html>
<html>
<head>
  <title>WebSocket Test</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #00ff00; }
    .log { margin: 10px 0; padding: 5px; border-left: 2px solid #00ff00; }
    .error { color: #ff0000; }
    .success { color: #00ff00; }
  </style>
</head>
<body>
  <h1>WebSocket Connection Test</h1>
  <div id="log"></div>
  <script>
    const logDiv = document.getElementById('log');
    
    function log(msg, type = 'info') {
      const div = document.createElement('div');
      div.className = `log ${type}`;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      logDiv.appendChild(div);
      console.log(msg);
    }
    
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
  // use config helper if available
  const wsUrl = (typeof getWsUrl === 'function') ? getWsUrl() : `${wsProtocol}//192.168.1.182:3000`;
  const ws = new WebSocket(wsUrl);
    
    ws.onopen = () => {
      log('âœ“ WebSocket connected!', 'success');
    };
    
    ws.onmessage = (event) => {
      try {
        const message = JSON.parse(event.data);
        log(`Message received: ${message.type} with ${Object.keys(message.data || {}).join(', ')}`, 'success');
        if (message.data.products) {
          log(`  - Products: ${message.data.products.length} items`, 'success');
        }
        if (message.data.orders) {
          log(`  - Orders: ${message.data.orders.length} items`, 'success');
        }
      } catch (e) {
        log(`Error parsing message: ${e.message}`, 'error');
      }
    };
    
    ws.onerror = (err) => {
      log(`WebSocket error: ${err}`, 'error');
    };
    
    ws.onclose = () => {
      log('WebSocket closed', 'error');
    };
  </script>
</body>
</html>
